// Code generated by gen.getter_functions.go; DO NOT EDIT.

package {{.Package}}

import (
	"context"
	"strings"

	"cape-project.eu/provider/pulumi/config"
	"cape-project.eu/provider/pulumi/internal/schemas"
	api "cape-project.eu/provider/pulumi/secapi/{{.APIPackage}}"
	"github.com/pulumi/pulumi-go-provider/infer"
)

// goverter:variables
// goverter:output:format assign-variable
// goverter:output:file ./converters.init.gen.go
// goverter:extend cape-project.eu/provider/pulumi/internal/convertors:Convert.*
// goverter:useZeroValueOnPointerInconsistency
var (
	// goverter:ignore Accept
	convert{{.Name}}ArgsToOpenAPI func({{.Name}}Args) api.{{.ClientFunction}}Params

	convertOpenAPITo{{.Name}}Result func(api.{{.ResponseType}}) {{.Name}}Result
)

type {{.Name}} struct{}

type {{.Name}}Args struct {
	Tenant    *string `pulumi:"tenant,optional"`
	SkipToken *string `pulumi:"skipToken,optional"`
	Limit     *int    `pulumi:"limit,optional"`
	Labels    *string `pulumi:"labels,optional"`
}

type {{.Name}}Result struct {
	Items    []schemas.{{.OutputType}} `pulumi:"items"`
	Metadata schemas.ResponseMetadata `pulumi:"metadata"`
}

func ({{.Name}}) Invoke(ctx context.Context, req infer.FunctionRequest[{{.Name}}Args]) (infer.FunctionResponse[{{.Name}}Result], error) {
	config := infer.GetConfig[config.Config](ctx)
	url := config.BaseURL
	prefix := *config.{{.Package | pascalCase}}ProviderPrefix
	if prefix != "" {
		switch true {
		case strings.HasSuffix(url, "/") && strings.HasPrefix(prefix, "/"):
			url = url + prefix[1:]
		case !strings.HasSuffix(url, "/") && !strings.HasPrefix(prefix, "/"):
			url = url + "/" + prefix
		default:
			url = url + prefix
		}
	}
	client, err := api.NewClientWithResponses(url)
	if err != nil {
		return infer.FunctionResponse[{{.Name}}Result]{}, err
	}

    var tenant{{- if not .WithoutWorkspace}}, workspace{{- end}} string
	if req.Input.Tenant == nil {
		tenant = config.Tenant
	} else {
		tenant = *req.Input.Tenant
	}
{{- if not .WithoutWorkspace}}
	if req.Input.Workspace != nil {
		workspace = *req.Input.Workspace
	} else if config.Workspace != nil {
		workspace = *config.Workspace
	} else {
		return infer.FunctionResponse[{{.Name}}Result]{}, fmt.Errorf("workspace not given for {{.Name}} call %s", req.Name)
	}
{{- end}}

	params := convert{{.Name}}ArgsToOpenAPI(req.Input)
	res, err := client.{{.ClientFunction}}WithResponse(ctx, tenant, {{- if not .WithoutWorkspace}} workspace,{{end}} &params)
	if err != nil {
		return infer.FunctionResponse[{{.Name}}Result]{}, err
	}

	return infer.FunctionResponse[{{.Name}}Result]{
		Output: convertOpenAPITo{{.Name}}Result(*res.JSON200),
	}, nil
}
